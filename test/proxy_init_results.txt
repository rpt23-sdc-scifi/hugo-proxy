# PROXY API GET REQUESTS:

import http from "k6/http";

import { Rate } from "k6/metrics";

const myFailRate = new Rate("failed requests");

export let options = {
  discardResponseBodies: true,
  scenarios: {
    rps_100: {
      executor: "constant-arrival-rate",
      exec: "getCommentsApi",
      rate: 100,
      timeUnit: "4s",
      duration: "2m",
      preAllocatedVUs: 100,
      maxVUs: 200,
    },
    rps_500: {
      executor: "constant-arrival-rate",
      exec: "getCommentsApi",
      rate: 500,
      timeUnit: "4s",
      duration: "2m",
      startTime: "2m",
      preAllocatedVUs: 500,
      maxVUs: 1000,
    },
    rps_750: {
      executor: "constant-arrival-rate",
      exec: "getCommentsApi",
      rate: 750,
      timeUnit: "4s",
      duration: "2m",
      startTime: "4m",
      preAllocatedVUs: 1000,
      maxVUs: 2000,
    },
    rps_1000: {
      executor: "constant-arrival-rate",
      exec: "getCommentsApi",
      rate: 1000,
      timeUnit: "4s",
      duration: "2m",
      startTime: "6m",
      preAllocatedVUs: 1500,
      maxVUs: 3000,
    },
    rps_1500: {
      executor: "constant-arrival-rate",
      exec: "getCommentsApi",
      rate: 1500,
      timeUnit: "4s",
      duration: "2m",
      startTime: "8m",
      preAllocatedVUs: 2000,
      maxVUs: 3000,
    },
  },
  thresholds: {
    // threshold (custom metric): 2% or less of requests return a 400 response (error / invalid request)
    "failed requests": [{ threshold: "rate<0.02", abortOnFail: true }],
    // threshold broken up by scenarios: 90% of requests must finish within 500ms, 95% within 800, and 99.9% within 1.5s.
    'http_req_duration{scenario:rps_100}': [
      {
        threshold: "p(90) < 500",
        abortOnFail: true,
      },
      {
        threshold: "p(95) < 800",
        abortOnFail: true,
      },
      {
        threshold: "p(99.9) < 2000",
        abortOnFail: true,
      },
      {
        threshold: "avg < 700",
        abortOnFail: true,
      },
    ],
    'http_req_duration{scenario:rps_500}': [
      {
        threshold: "p(90) < 500",
        abortOnFail: true,
      },
      {
        threshold: "p(95) < 800",
        abortOnFail: true,
      },
      {
        threshold: "p(99.9) < 2000",
        abortOnFail: true,
      },
      {
        threshold: "avg < 700",
        abortOnFail: true,
      },
    ],
    'http_req_duration{scenario:rps_750}': [
      {
        threshold: "p(90) < 500",
        // abortOnFail: true,
      },
      {
        threshold: "p(95) < 800",
        // abortOnFail: true,
      },
      {
        threshold: "p(99.9) < 2000",
        // abortOnFail: true,
      },
      {
        threshold: "avg < 700",
        // abortOnFail: true,
      },
    ],
    'http_req_duration{scenario:rps_1000}': [
      {
        threshold: "p(90) < 500",
        // abortOnFail: true,
      },
      {
        threshold: "p(95) < 800",
        // abortOnFail: true,
      },
      {
        threshold: "p(99.9) < 2000",
        // abortOnFail: true,
      },
      {
        threshold: "avg < 700",
        // abortOnFail: true,
      },
    ],
    'http_req_duration{scenario:rps_1500}': [
      {
        threshold: "p(90) < 500",
        // abortOnFail: true,
      },
      {
        threshold: "p(95) < 800",
        // abortOnFail: true,
      },
      {
        threshold: "p(99.9) < 2000",
        // abortOnFail: true,
      },
      {
        threshold: "avg < 700",
        // abortOnFail: true,
      },
    ],
  },
};

export function getCommentsApi() {
  const commentId = Math.ceil(Math.random() * 100000000);
  const resCommentQuery = http.get(
    `http://localhost:4000/api/comments/${commentId}`
  );
  myFailRate.add(resCommentQuery.status !== 200);

  const userId = Math.ceil(Math.random() * 10000000);
  const resUserQuery = http.get(
    `http://localhost:4000/api/comments?user_id=${userId}`
  );
  myFailRate.add(resUserQuery.status !== 200 && resUserQuery.status !== 404);

  const songId = Math.ceil(Math.random() * 10000000);
  const resSongQuery = http.get(
    `http://localhost:4000/api/comments?song_id=${songId}`
  );
  myFailRate.add(resSongQuery.status !== 200 && resSongQuery.status !== 404);

  const content = encodeURIComponent("Lorem ad aliquip et minim.");
  const resContentQuery = http.get(
    `http://localhost:4000/api/comments?content=${content}`
  );
  myFailRate.add(resContentQuery.status !== 200);
}


          /\      |‾‾| /‾‾/   /‾‾/
     /\  /  \     |  |/  /   /  /
    /  \/    \    |     (   /   ‾‾\
   /          \   |  |\  \ |  (‾)  |
  / __________ \  |__| \__\ \_____/ .io

  execution: local
     script: test/k6_api_get.js
     output: -

  scenarios: (100.00%) 5 scenarios, 8000 max VUs, 10m30s max duration (incl. graceful stop):
           * rps_100: 25.00 iterations/s for 2m0s (maxVUs: 100-200, exec: getCommentsApi, gracefulStop: 30s)
           * rps_500: 125.00 iterations/s for 2m0s (maxVUs: 500-1000, exec: getCommentsApi, startTime: 2m0s, gracefulStop: 30s)
           * rps_750: 187.50 iterations/s for 2m0s (maxVUs: 1000-2000, exec: getCommentsApi, startTime: 4m0s, gracefulStop: 30s)
           * rps_1000: 250.00 iterations/s for 2m0s (maxVUs: 2000-3000, exec: getCommentsApi, startTime: 6m0s, gracefulStop: 30s)
           * rps_1500: 375.00 iterations/s for 2m0s (maxVUs: 3000-5000, exec: getCommentsApi, startTime: 8m0s, gracefulStop: 30s)

WARN[0161] Insufficient VUs, reached 1000 active VUs and cannot initialize more  executor=constant-arrival-rate scenario=rps_500

running (03m28.2s), 0000/5500 VUs, 7807 complete and 1001 interrupted iterations
rps_100  ✓ [======================================] 100/100 VUs    2m0s          25 iters/s
rps_500  ✗ [==========================>-----------] 1000/1000 VUs  1m28.1s/2m0s  125 iters/s
rps_750  • [--------------------------------------] waiting        0m31.8s
rps_1000 • [--------------------------------------] waiting        2m31.8s
rps_1500 • [--------------------------------------] waiting        4m31.8s

    data_received..............: 31 MB  148 kB/s
    data_sent..................: 3.8 MB 18 kB/s
    dropped_iterations.........: 5209   25.02173/s
  ✗ failed requests............: 2.08%  ✓ 677    ✗ 31780
    http_req_blocked...........: avg=5.21ms  min=1µs     med=235µs    max=23.77s   p(90)=526µs   p(95)=790.19µs
    http_req_connecting........: avg=5.15ms  min=0s      med=181µs    max=23.77s   p(90)=427µs   p(95)=607.19µs
    http_req_duration..........: avg=1.78s   min=2.3ms   med=41.08ms  max=30.92s   p(90)=1.23s   p(95)=22.4s
    ✓ { scenario:rps_100 }.....: avg=8.33ms  min=2.3ms   med=5.13ms   max=141.98ms p(90)=19.25ms p(95)=24.41ms
    ✗ { scenario:rps_500 }.....: avg=2.83s   min=2.4ms   med=523.45ms max=30.92s   p(90)=7.76s   p(95)=22.98s
    http_req_receiving.........: avg=50.28µs min=15µs    med=45µs     max=3.32ms   p(90)=64µs    p(95)=74µs
    http_req_sending...........: avg=65.31µs min=7µs     med=46µs     max=7.66ms   p(90)=74µs    p(95)=101µs
    http_req_tls_handshaking...: avg=0s      min=0s      med=0s       max=0s       p(90)=0s      p(95)=0s
    http_req_waiting...........: avg=1.78s   min=2.22ms  med=40.97ms  max=30.92s   p(90)=1.23s   p(95)=22.4s
    http_reqs..................: 32457  155.909062/s
    iteration_duration.........: avg=6.32s   min=12.39ms med=585.55ms max=59.53s   p(90)=25.85s  p(95)=31.32s
    iterations.................: 7807   37.501373/s
    vus........................: 1000   min=100  max=1000
    vus_max....................: 5500   min=5000 max=5500

ERRO[0221] some thresholds have failed


# API POST REQUESTS:

import http from "k6/http";

import { Rate } from "k6/metrics";

const myFailRate = new Rate("failed requests");
const maxSongLength = 480; // in seconds

export let options = {
  discardResponseBodies: true,
  scenarios: {
    rps_100: {
      executor: "constant-arrival-rate",
      exec: "postCommentsApi",
      rate: 100,
      timeUnit: "1s",
      duration: "30s",
      preAllocatedVUs: 200,
      maxVUs: 500,
    },
    rps_500: {
      executor: "constant-arrival-rate",
      exec: "postCommentsApi",
      rate: 500,
      timeUnit: "1s",
      duration: "30s",
      startTime: "30s",
      preAllocatedVUs: 1000,
      maxVUs: 2000,
    },
    rps_750: {
      executor: "constant-arrival-rate",
      exec: "postCommentsApi",
      rate: 750,
      timeUnit: "1s",
      duration: "30s",
      startTime: "1m",
      preAllocatedVUs: 1500,
      maxVUs: 3000,
    },
    rps_1000: {
      executor: "constant-arrival-rate",
      exec: "postCommentsApi",
      rate: 1000,
      timeUnit: "1s",
      duration: "30s",
      startTime: "1m30s",
      preAllocatedVUs: 2000,
      maxVUs: 4000,
    },
    rps_1500: {
      executor: "constant-arrival-rate",
      exec: "postCommentsApi",
      rate: 1500,
      timeUnit: "1s",
      duration: "30s",
      startTime: "2m",
      preAllocatedVUs: 3000,
      maxVUs: 5000,
    },
  },
  thresholds: {
    // threshold (custom metric): 2% or less of requests return a 400 response (error / invalid request)
    "failed requests": [{ threshold: "rate<0.02", abortOnFail: true }],
    // threshold broken up by scenarios: 90% of requests must finish within 500ms, 95% within 800, and 99.9% within 1.5s.
    "http_req_duration{scenario:rps_100}": [
      {
        threshold: "p(90) < 500",
        // abortOnFail: true,
      },
      {
        threshold: "p(95) < 800",
        // abortOnFail: true,
      },
      {
        threshold: "p(99.9) < 2000",
        // abortOnFail: true,
      },
      {
        threshold: "avg < 700",
        // abortOnFail: true,
      },
    ],
    "http_req_duration{scenario:rps_500}": [
      {
        threshold: "p(90) < 500",
        // abortOnFail: true,
      },
      {
        threshold: "p(95) < 800",
        // abortOnFail: true,
      },
      {
        threshold: "p(99.9) < 2000",
        // abortOnFail: true,
      },
      {
        threshold: "avg < 700",
        // abortOnFail: true,
      },
    ],
    "http_req_duration{scenario:rps_750}": [
      {
        threshold: "p(90) < 500",
        // abortOnFail: true,
      },
      {
        threshold: "p(95) < 800",
        // abortOnFail: true,
      },
      {
        threshold: "p(99.9) < 2000",
        // abortOnFail: true,
      },
      {
        threshold: "avg < 700",
        // abortOnFail: true,
      },
    ],
    "http_req_duration{scenario:rps_1000}": [
      {
        threshold: "p(90) < 500",
        // abortOnFail: true,
      },
      {
        threshold: "p(95) < 800",
        // abortOnFail: true,
      },
      {
        threshold: "p(99.9) < 2000",
        // abortOnFail: true,
      },
      {
        threshold: "avg < 700",
        // abortOnFail: true,
      },
    ],
    "http_req_duration{scenario:rps_1500}": [
      {
        threshold: "p(90) < 500",
        // abortOnFail: true,
      },
      {
        threshold: "p(95) < 800",
        // abortOnFail: true,
      },
      {
        threshold: "p(99.9) < 2000",
        // abortOnFail: true,
      },
      {
        threshold: "avg < 700",
        // abortOnFail: true,
      },
    ],
  },
};

export function postCommentsApi() {
  const url = "http://localhost:8000/api/comments";
  let headers = { "Content-Type": "application/json" };
  let data = {
    user_id: Math.ceil(Math.random() * 10000000),
    song_id: Math.ceil(Math.random() * 10000000),
    content: "k6 placeholder text",
    time_stamp: Math.floor(Math.random() * maxSongLength),
  };

  let res = http.post(url, JSON.stringify(data), { headers: headers });
  myFailRate.add(res.status !== 201);
}


          /\      |‾‾| /‾‾/   /‾‾/
     /\  /  \     |  |/  /   /  /
    /  \/    \    |     (   /   ‾‾\
   /          \   |  |\  \ |  (‾)  |
  / __________ \  |__| \__\ \_____/ .io

  execution: local
     script: test/k6_api_post.js
     output: -

  scenarios: (100.00%) 5 scenarios, 9000 max VUs, 3m0s max duration (incl. graceful stop):
           * rps_100: 100.00 iterations/s for 30s (maxVUs: 200-500, exec: postCommentsApi, gracefulStop: 30s)
           * rps_500: 500.00 iterations/s for 30s (maxVUs: 1000-2000, exec: postCommentsApi, startTime: 30s, gracefulStop: 30s)
           * rps_750: 750.00 iterations/s for 30s (maxVUs: 1500-3000, exec: postCommentsApi, startTime: 1m0s, gracefulStop: 30s)
           * rps_1000: 1000.00 iterations/s for 30s (maxVUs: 2000-4000, exec: postCommentsApi, startTime: 1m30s, gracefulStop: 30s)
           * rps_1500: 1500.00 iterations/s for 30s (maxVUs: 3000-5000, exec: postCommentsApi, startTime: 2m0s, gracefulStop: 30s)

WARN[0021] Insufficient VUs, reached 500 active VUs and cannot initialize more  executor=constant-arrival-rate scenario=rps_100
WARN[0054] Insufficient VUs, reached 2000 active VUs and cannot initialize more  executor=constant-arrival-rate scenario=rps_500
WARN[0070] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56709->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56742->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56578->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56657->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56577->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56579->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56658->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56743->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56751->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56670->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56760->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56673->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56594->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56676->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56769->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56765->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56679->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56601->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56691->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56608->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56615->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56617->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56697->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56792->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56791->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56580->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56618->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56746->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56582->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56586->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56593->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56767->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56605->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56773->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56794->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56614->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56701->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56700->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56747->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56798->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56660->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56745->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56583->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56662->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56752->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56744->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56659->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56749->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56663->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56664->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56584->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56588->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56750->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56667->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56668->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56756->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56758->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56669->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56589->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56757->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56590->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56759->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56661->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56671->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56753->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56587->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56755->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56666->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56754->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56748->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56672->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56762->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56595->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56674->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56764->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56761->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56763->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56597->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56675->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56768->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56604->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56678->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56681->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56598->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56687->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56686->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56771->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56775->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56603->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56683->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56599->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56780->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56685->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56776->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56778->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56779->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56684->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56772->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56682->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56600->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56781->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56606->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56596->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56777->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56677->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56693->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56790->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56688->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56613->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56612->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56787->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56788->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56783->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56782->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56609->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56610->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56689->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56784->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56774->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56690->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56785->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56611->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56692->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56694->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56786->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56789->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56695->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56797->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56796->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56619->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56795->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56620->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56793->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56698->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56703->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56581->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56665->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56585->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56592->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56591->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56680->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56770->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56602->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56607->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56696->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56616->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56699->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56702->127.0.0.1:8000: read: connection reset by peer"
WARN[0071] Request Failed                                error="Post \"http://localhost:8000/api/comments\": read tcp 127.0.0.1:56766->127.0.0.1:8000: read: connection reset by peer"

running (1m02.2s), 0000/6300 VUs, 149 complete and 3850 interrupted iterations
rps_100  ✓ [======================================] 500/500 VUs    30s        100 iters/s
rps_500  ✗ [======================================] 2000/2000 VUs  30s        500 iters/s
rps_750  ✗ [=>------------------------------------] 1500/1500 VUs  02.0s/30s  750 iters/s
rps_1000 • [--------------------------------------] waiting        0m27.8s
rps_1500 • [--------------------------------------] waiting        0m57.8s

    data_received..............: 0 B     0 B/s
    data_sent..................: 920 kB  15 kB/s
    dropped_iterations.........: 15501   249.293684/s
  ✗ failed requests............: 100.00% ✓ 149    ✗ 0
    http_req_blocked...........: avg=486.31ms min=130.03ms med=494.56ms max=636.14ms p(90)=619.28ms p(95)=628.5ms
    http_req_connecting........: avg=486.17ms min=129.9ms  med=494.41ms max=636.05ms p(90)=619.2ms  p(95)=628.42ms
    http_req_duration..........: avg=26.77ms  min=2.27ms   med=26.97ms  max=31.33ms  p(90)=27.94ms  p(95)=28.02ms
    ✓ { scenario:rps_750 }.....: avg=26.77ms  min=2.27ms   med=26.97ms  max=31.33ms  p(90)=27.94ms  p(95)=28.02ms
    http_req_receiving.........: avg=0s       min=0s       med=0s       max=0s       p(90)=0s       p(95)=0s
    http_req_sending...........: avg=1.4ms    min=37µs     med=1.49ms   max=2.91ms   p(90)=2.28ms   p(95)=2.37ms
    http_req_tls_handshaking...: avg=0s       min=0s       med=0s       max=0s       p(90)=0s       p(95)=0s
    http_req_waiting...........: avg=25.37ms  min=2.23ms   med=25.61ms  max=31.28ms  p(90)=27.54ms  p(95)=27.76ms
    http_reqs..................: 149     2.396281/s
    iteration_duration.........: avg=579.31ms min=132.93ms med=576.24ms max=790.18ms p(90)=730.92ms p(95)=743.49ms
    iterations.................: 149     2.396281/s
    vus........................: 3500    min=200  max=3500
    vus_max....................: 6300    min=5000 max=6300

ERRO[0073] some thresholds have failed  